# 設計依頼書: 常時録画・録音システム

**依頼元**: Yoshihitoさん / Claude Code
**依頼先**: Codex
**作成日**: 2026-01-16

---

## 1. 概要

Raspberry Pi 4Bを使用した24時間稼働の監視カメラシステムの設計を依頼します。

## 2. ハードウェア構成（設置・認識完了済み）

### 本体

| 項目 | 詳細 |
|------|------|
| 機種 | Raspberry Pi 4B（8GBモデル） |
| OS | Debian GNU/Linux 13 (trixie) |
| ネットワーク | 有線LAN接続 |
| 固定IP | 10.18.52.48 |
| SSH接続 | `ssh rp402`（鍵認証設定済み） |
| ユーザー | pi |

### カメラ

| 項目 | 詳細 |
|------|------|
| カメラ | Raspberry Pi Camera Module 3 NoIR |
| センサ | IMX708（赤外線対応） |
| 接続方式 | CSI接続 |
| ツール | rpicam-apps（libcamera系） |
| 動作確認 | 30fps動作確認済み |

### マイク

| 項目 | 詳細 |
|------|------|
| 接続方式 | USB接続 |
| デバイス | USB PnP Audio Device（JMTek, LLC.） |
| ALSA認識 | card 1 |
| 動作確認 | デバイス認識済み（録音品質は未検証） |

## 3. 要件

### 機能要件

| 項目 | 要件 |
|------|------|
| 録画方式 | 常時録画・録音（コンビニ方式） |
| 画質 | 低画質（容量優先、640x480程度を想定） |
| 音質 | 低音質（モノラル、16kbps程度を想定） |
| ファイル分割 | 1時間ごと |
| ファイル形式 | 音声+映像を1ファイルに統合 |

### 保存要件

| 項目 | 要件 |
|------|------|
| 一次保存先 | USBメモリ（32GB） |
| クラウド保存 | Googleドライブ |
| 保持期間 | USB: 7日間 / Googleドライブ: 30日間 |
| ローテーション | USB: 7日以上経過したファイルを自動削除 / Googleドライブ: 30日以上経過したファイルを自動削除 |

### 容量計算

- USB 32GBで7日間（168時間）保存
- 目標: 約190MB/時間（≒0.4Mbps）以下

### 非機能要件

| 項目 | 要件 |
|------|------|
| 稼働時間 | 24時間365日 |
| 安定性 | 自動復旧機能（録画停止時の自動再開） |
| 監視 | 録画状態の監視・通知（オプション） |

## 4. 設計依頼事項

1. **システムアーキテクチャ設計**
   - 録画・録音・保存・アップロードの処理フロー
   - 各コンポーネントの役割と連携方法

2. **技術選定**
   - 録画ツール（ffmpeg / rpicam-vid 等）
   - 音声+映像の統合方法
   - Googleドライブ連携方法（rclone等）

3. **ファイル命名規則**
   - 日時ベースの命名規則

4. **エラーハンドリング設計**
   - 録画失敗時の対応
   - ストレージ不足時の対応
   - ネットワーク障害時の対応

5. **24H稼働の安定性対策**
   - 温度監視
   - 自動再起動の仕組み
   - プロセス監視

## 5. 制約事項

- 開発はMac上のClaude Codeで行い、SSHでRaspberry Piに接続して実装・テスト
- Pythonを主要言語として使用予定
- 低コストで実現（追加ハードウェア購入は最小限）

## 6. 参考情報

- Raspberry Pi公式カメラドキュメント
- rpicam-apps（libcamera）
- ffmpeg
- rclone（Googleドライブ連携）

---

**Codexへ**: 上記要件に基づき、システム設計をお願いします。
